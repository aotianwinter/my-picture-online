{"version":3,"sources":["basicUI/ImgView/loading.gif","components/MenuBar/index.js","basicUI/ImgView/style.js","basicUI/ImgView/index.js","basicUI/ImgListView/style.js","basicUI/ImgListView/index.js","basicUI/ImgPreview/index.js","basicUI/DownloadModal/download.js","config/download_options.js","basicUI/DownloadModal/index.js","api/axios.js","views/WallPaper/index.js","api/getData.js"],"names":["module","exports","React","memo","props","menus","i","data","push","length","Menu","secondary","compact","size","style","background","width","overflow","map","item","index","Item","onClick","onMenuClick","id","key","name","ImgWrap","styled","div","url","tag","useState","isLoaded","setIsLoaded","handleLoaded","useCallback","filterUrl","array","split","Image","hidden","className","src","loadingImg","rounded","CSSTransition","in","classNames","appear","timeout","unmountOnExit","onLoad","opacity","title","alt","Icon","onPreviewClick","color","onDownloadClick","ImgListViewWrap","ImgViewWrap","height","imgList","document","body","clientWidth","toFixed","offset","handlePreview","handleDownload","utag","previewImg","Dimmer","active","visible","handleClick","page","maxHeight","download","fileName","x","XMLHttpRequest","responseType","open","send","onload","downloadElement","createElement","href","window","URL","createObjectURL","response","appendChild","click","removeChild","revokeObjectURL","downloadOptions","desc","filterParam","downloadImg","Modal","basic","dimmer","Header","icon","content","Content","List","verticalAlign","floated","Button","param","test","navigator","userAgent","alert","inverted","Label","Actions","onClose","axios","defaults","method","config","a","toLowerCase","params","console","error","interceptors","request","use","Promise","reject","withRouter","cid","match","start","count","queryInfo","setQueryInfo","isLoading","setIsLoading","isPreview","setIsPreview","isDownload","setIsDownload","isFinished","setIsFinished","currentImg","setCurrentImg","setImgList","typeList","setTypeList","contextRef","createRef","useEffect","getTypes","updateImgList","getCategories","res","forEach","replace","concat","handlePreviewImg","img","handleDownloadImg","hideImgPreview","hideDownloadModal","ref","Sticky","context","styleElement","zIndex","history","scrollTop","documentElement","initialLoad","pageStart","loadMore","hasMore","threshold","textAlign"],"mappings":"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","file":"static/js/7.20ec5e98.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/loading.446d49ea.gif\";","import React from 'react'\r\nimport { Menu } from 'semantic-ui-react'\r\n\r\nfunction MenuBar (props) {\r\n  const menus = []\r\n  for (let i in props.data) {\r\n    menus.push(props.data[i])\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {\r\n        menus.length ?\r\n          <Menu secondary compact size='mini' style={{ background: 'white', width: '100%', overflow: 'auto' }}>\r\n            {\r\n              menus.map((item, index) => {\r\n                return (\r\n                  <Menu.Item onClick={() => props.onMenuClick(item.id)} key={index}>\r\n                    {item.name}\r\n                  </Menu.Item>\r\n                )\r\n              })\r\n            }\r\n          </Menu> : null\r\n      }\r\n    </>\r\n  )\r\n}\r\n\r\nexport default React.memo(MenuBar)\r\n","import styled from 'styled-components'\r\n\r\nexport const ImgWrap = styled.div`\r\n  position: relative;\r\n  display: inline-block;\r\n  height: 100%;\r\n  width: 100%;\r\n\r\n  .img-placeholder {\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    transform: translate(-50%, -50%);\r\n    object-fit: cover;\r\n    max-height: 100%;\r\n    max-width: 100%;\r\n  }\r\n\r\n  :hover {\r\n    box-shadow: 2px 4px 5px rgba(0, 0, 0, 0.8);\r\n    .dim__wrap {\r\n      display: block;\r\n    }\r\n  }\r\n\r\n  .dim__wrap {\r\n    display: none;\r\n    position: absolute;\r\n    width: 100%;\r\n    bottom: 0px;\r\n    background: rgba(0, 0, 0, 0.4);\r\n    padding: 4px;\r\n    text-align: right;\r\n\r\n    .tag {\r\n      color: white;\r\n      float: left;\r\n    }\r\n  }\r\n`","import React, { useState, useCallback } from 'react'\r\nimport { Image, Icon } from 'semantic-ui-react'\r\nimport { CSSTransition } from 'react-transition-group'\r\nimport { ImgWrap } from './style'\r\nimport loadingImg from './loading.gif'\r\nimport './fade.css'\r\n\r\nfunction ImgView (props) {\r\n  const { url, tag } = props\r\n\r\n  const [isLoaded, setIsLoaded] = useState(false)\r\n\r\n  // cache memoized version of inline callback\r\n  const handleLoaded = useCallback(() => {\r\n    setIsLoaded(true)\r\n  }, [])\r\n\r\n  const filterUrl = () => {\r\n    const array = url.split('/bdr/__85/')\r\n    // 过滤url为低分辨率图片，防止加载时间较长\r\n    return array.length !== 2 ? url : array[0] + '/bdm/640_360_85/' + array[1]\r\n  }\r\n\r\n  // 正式Image未加载之前没有高度信息\r\n  return (\r\n    <ImgWrap>\r\n      <Image hidden={ isLoaded } className='img-placeholder' src={ loadingImg } rounded />\r\n      <CSSTransition\r\n        in={true}\r\n        classNames={'fade'}\r\n        appear={true}\r\n        key={1}\r\n        timeout={300}\r\n        unmountOnExit={true}\r\n        >\r\n        <Image onLoad={ handleLoaded } style={{ opacity: isLoaded ? 1 : 0 }}\r\n          src={ filterUrl() } title={ tag } alt={ tag } rounded />\r\n      </CSSTransition>\r\n      <div className='dim__wrap'>\r\n        <span className='tag'>{ tag }</span>\r\n        <Icon onClick={ () => props.onPreviewClick() } name='eye' color='orange' />\r\n        <Icon onClick={ () => props.onDownloadClick() } name='download' color='teal' src={ filterUrl() } />\r\n      </div>\r\n    </ImgWrap>\r\n  )\r\n}\r\n\r\nexport default React.memo(ImgView)","import styled from 'styled-components'\r\n\r\nexport const ImgListViewWrap = styled.div`\r\n  text-align: center;\r\n`\r\n\r\nexport const ImgViewWrap = styled.div`\r\n  display: inline-block;\r\n  width: ${props=>props.width};\r\n  height: ${props=>props.height};\r\n`","import React from 'react'\r\nimport LazyLoad from 'react-lazyload'\r\nimport ImgView from '../ImgView'\r\nimport { ImgListViewWrap, ImgViewWrap } from './style'\r\n\r\nfunction ImgListView (props) {\r\n  const imgList = props.data\r\n\r\n  const width = (1 / (document.body.clientWidth / 360) * document.body.clientWidth).toFixed(3)\r\n  const height = (width * 0.5625).toFixed(3)\r\n\r\n  return (\r\n    <ImgListViewWrap>\r\n      {\r\n        imgList.length > 0 ? imgList.map((item) => {\r\n          return (\r\n            <ImgViewWrap key={item.id} width={ width + 'px' } height={ height + 'px' }>\r\n              <LazyLoad height={'100%'} offset={200} >\r\n                <ImgView\r\n                  key={item.id}\r\n                  onPreviewClick={() => props.handlePreview(item)}\r\n                  onDownloadClick={() => props.handleDownload(item)}\r\n                  url={item.url} tag={ item.utag }\r\n                  />\r\n              </LazyLoad>\r\n            </ImgViewWrap>\r\n          )\r\n        }) : null\r\n      }\r\n    </ImgListViewWrap>\r\n  )\r\n}\r\n\r\nexport default React.memo(ImgListView)","import React from 'react'\r\nimport { Dimmer, Image } from 'semantic-ui-react'\r\n\r\nfunction ImgPreview (props) {\r\n  const { url, utag } = props.previewImg\r\n\r\n  return (\r\n    <Dimmer active={ props.visible } onClick={props.handleClick} page>\r\n      <Image style={{ maxHeight: '90vh' }} src={ url } title={ utag } alt={ utag } />\r\n    </Dimmer>\r\n  )\r\n}\r\n\r\nexport default React.memo(ImgPreview)","function download (url, fileName) {\r\n  const x = new XMLHttpRequest()\r\n  x.responseType = 'blob'\r\n  x.open('GET', url, true)\r\n  x.send()\r\n  x.onload = () => {\r\n    const downloadElement = document.createElement('a')\r\n    const href = window.URL.createObjectURL(x.response) // create download url\r\n    downloadElement.href = href\r\n    downloadElement.download = fileName // set filename (include suffix)\r\n    document.body.appendChild(downloadElement) // append <a>\r\n    downloadElement.click() // click download\r\n    document.body.removeChild(downloadElement) // remove <a>\r\n    window.URL.revokeObjectURL(href) // revoke blob\r\n  }\r\n}\r\n\r\nexport { download }","const downloadOptions = [\r\n  // {\r\n  //   desc: '4096 x 2160',\r\n  //   filterParam: '/bdm/4096_2160_85/'\r\n  // },\r\n  // {\r\n  //   desc: '2560 x 1440',\r\n  //   filterParam: '/bdm/2560_1440_85/'\r\n  // },\r\n  {\r\n    desc: '1920 x 1080',\r\n    filterParam: '/bdm/1920_1080_85/'\r\n  },\r\n  {\r\n    desc: '1366 x 768',\r\n    filterParam: '/bdm/1366_768_85/'\r\n  }\r\n]\r\n\r\nexport default downloadOptions","import React from 'react'\r\nimport { Button, Modal, Label, Header, List } from 'semantic-ui-react'\r\nimport { download } from './download'\r\nimport downloadOptions from '../../config/download_options'\r\n\r\nfunction DownloadModal (props) {\r\n  const { url, utag } = props.downloadImg\r\n\r\n  const handleDownload = (param) => {\r\n    // Safari Tip\r\n    if (/Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent)) {\r\n      alert('抱歉😅！暂不支持Safari下载！请手动保存照片！')\r\n      return\r\n    }\r\n    const array = url.split('/bdr/__85/')\r\n    array.length === 2 ? download(array[0] + param + array[1], utag + '.jpg') : download(url, utag + '.jpg')\r\n  }\r\n\r\n  return (\r\n    <Modal basic dimmer={ 'blurring' } open={ props.visible }>\r\n      <Header icon='browser' content='download options' />\r\n      <Modal.Content>\r\n        <List verticalAlign='middle'>\r\n          { downloadOptions.length > 0\r\n            ? downloadOptions.map((item, index) => {\r\n            return (\r\n              <List.Item key={ index }>\r\n                <List.Content floated='right'>\r\n                  <Button onClick={ () => handleDownload(item.filterParam) }\r\n                    basic color='green' icon='download' inverted size='mini' />\r\n                </List.Content>\r\n                <List.Content>\r\n                  <Label>{ item.desc }</Label>\r\n                </List.Content>\r\n              </List.Item>\r\n            )\r\n          }) : null }\r\n        </List>\r\n      </Modal.Content>\r\n      <Modal.Actions>\r\n        <Button onClick={ () => props.onClose() } color='green' inverted>\r\n          OK\r\n        </Button>\r\n      </Modal.Actions>\r\n    </Modal>\r\n  )\r\n}\r\n\r\nexport default React.memo(DownloadModal)\r\n","import axios from 'axios'\r\n\r\n// axios.defaults.baseURL = 'https://bird.ioliu.cn/v1?url=' // 本机3000端口\r\n\r\n// 请求超时时长\r\naxios.defaults.timeout = 10000\r\n\r\nexport default async (method, url, data, config) => {\r\n  method = method.toLowerCase()\r\n  // 根据method实现对应请求方式\r\n  switch (method) {\r\n    case 'get':\r\n      return axios({ method: 'get', url, params: data })\r\n    case 'post':\r\n      return axios({ method: 'post', url, data })\r\n    default:\r\n      console.error('请检查请求方式!')\r\n      return false\r\n  }\r\n}\r\n\r\n// 请求拦截器\r\naxios.interceptors.request.use(function (config) {\r\n  return config\r\n}, function (error) {\r\n  return Promise.reject(error)\r\n})\r\n\r\n// 响应拦截器\r\naxios.interceptors.response.use(function (response) {\r\n  return response\r\n}, function (error) {\r\n  return Promise.reject(error)\r\n})\r\n","import React, { useState, useEffect, createRef, useCallback } from 'react'\r\nimport { withRouter } from 'react-router-dom'\r\nimport InfiniteScroll from 'react-infinite-scroller'\r\nimport { Sticky } from 'semantic-ui-react'\r\n\r\n// import BackTop from '../../basicUI/BackTop'\r\nimport MenuBar from '../../components/MenuBar'\r\nimport ImgListView from '../../basicUI/ImgListView'\r\nimport ImgPreview from '../../basicUI/ImgPreview'\r\nimport DownloadModal from '../../basicUI/DownloadModal'\r\nimport CustomPlaceholder from '../../basicUI/Placeholder'\r\n\r\nimport { getCategories, getPictureList } from '../../api/getData'\r\n\r\nfunction PageWallPaper (props) {\r\n  const [queryInfo, setQueryInfo] = useState({ cid: props.match.params.id || 5, start: 0, count: 30 }) // query info\r\n  const [isLoading, setIsLoading] = useState(true) // is loading img\r\n  const [isPreview, setIsPreview] = useState(false) // is preview img\r\n  const [isDownload, setIsDownload] = useState(false) // is download modal show\r\n  const [isFinished, setIsFinished] = useState(false) // is all img loading finished\r\n\r\n  const [currentImg, setCurrentImg] = useState({}) // current img info\r\n  const [imgList, setImgList] = useState([])\r\n  const [typeList, setTypeList] = useState([])\r\n\r\n  const contextRef = createRef()\r\n\r\n  useEffect(() => {\r\n    getTypes()\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    updateImgList()\r\n  }, [queryInfo])\r\n\r\n  const getTypes = async () => {\r\n    const res = await getCategories()\r\n    if (res.data) {\r\n      setTypeList(res.data.data)\r\n    }\r\n  }\r\n  // update img list\r\n  const updateImgList = async () => {\r\n    const res = await getPictureList({...queryInfo})\r\n    if (res.data) {\r\n      if (res.data.data.length === 0) {\r\n        setIsFinished(true)\r\n      } else {\r\n        // 兼容https下载http资源 url更新为https\r\n        res.data.data.forEach(item => {\r\n          item.url = item.url.replace('http:', 'https:')\r\n        })\r\n        setImgList(imgList.concat(res.data.data))\r\n      }\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  const changeImgType = (id) => {\r\n    if (id !== queryInfo.cid) {\r\n      props.history.push('/wallpaper/' + id)\r\n    }\r\n    document.body.scrollTop = 0\r\n    document.documentElement.scrollTop = 0\r\n    // init state\r\n    setImgList([])\r\n    setIsLoading(true)\r\n    setIsFinished(false)\r\n    setQueryInfo({...queryInfo, cid: id })\r\n  }\r\n\r\n  const loadMoreImgs = () => {\r\n    setIsLoading(true)\r\n    setQueryInfo({...queryInfo, start: queryInfo.start + queryInfo.count})\r\n  }\r\n\r\n  // cache memoized version of inline callback\r\n  // click preview\r\n  const handlePreviewImg = useCallback((img) => {\r\n    setCurrentImg(img)\r\n    setIsPreview(true)\r\n  }, [])\r\n\r\n  // click download\r\n  const handleDownloadImg = useCallback((img) => {\r\n    setCurrentImg(img)\r\n    setIsDownload(true)\r\n  }, [])\r\n\r\n  // hide ImgPreview\r\n  const hideImgPreview = useCallback(() => {\r\n    setIsPreview(false)\r\n  }, [])\r\n  \r\n  // hide DownloadModal\r\n  const hideDownloadModal = useCallback(() => {\r\n    setIsDownload(false)\r\n  }, [])\r\n\r\n  return (\r\n    <div ref={contextRef}>\r\n      {/* img type menu */}\r\n      <Sticky context={contextRef} offset={48} styleElement={{ zIndex: '10' }}>\r\n        <MenuBar onMenuClick={ changeImgType } data={typeList} />\r\n      </Sticky>\r\n      {/* loading img (infinity) */}\r\n      <InfiniteScroll\r\n        initialLoad\r\n        pageStart={0}\r\n        loadMore={ loadMoreImgs }\r\n        hasMore={ !isLoading && !isFinished && imgList.length !== 0 }\r\n        threshold={50}\r\n      >\r\n        <ImgListView\r\n          handlePreview={ handlePreviewImg }\r\n          handleDownload = { handleDownloadImg }\r\n          data={ imgList }\r\n          />\r\n      </InfiniteScroll>\r\n      { isLoading ? <CustomPlaceholder /> : null }\r\n      { isFinished ? <h1 style={{ textAlign: 'center' }}>所有图片已加载完成！✨</h1> : null }\r\n      {/* img preview */}\r\n      <ImgPreview handleClick={ hideImgPreview } visible={ isPreview } previewImg={ currentImg } />\r\n      {/* download options */}\r\n      <DownloadModal onClose={ hideDownloadModal } visible={ isDownload } downloadImg={ currentImg } />\r\n      {/* back to top */}\r\n      {/* <BackTop /> */}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default withRouter(React.memo(PageWallPaper))\r\n","import axios from './axios'\r\n\r\nconst WINTER = '/winter'\r\n\r\n// 请求方式\r\nconst GET = 'get'\r\n// const POST = 'post'\r\n\r\nconst PICTURE = '/picture'\r\nexport const getCategories = (data) => axios(GET, 'https://bird.ioliu.cn/v1?url=http://cdn.apc.360.cn/index.php?c=WallPaper&a=getAllCategories', data)\r\nexport const getPictureList = (data) => axios(GET, 'https://bird.ioliu.cn/v1?url=http://wallpaper.apc.360.cn/index.php?c=WallPaper&a=getAppsByCategory', data)\r\n"],"sourceRoot":""}